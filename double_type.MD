# Понимание чисел с плавающей точкой

В этой статье предложено описание того, как представлено вещетсвенное число в двоимчном виде в памяти современных ПК.  
**Подробно можно ознакомиться в книге:**
<cite> Компьютерные системы 3 издание. Брайант и О'Халларон на стр.135. Глава 2.4. Числа с плавающей точкой</cite>

## Общее описание представления дробных величин

Первым шагом к пониманию чисел с плавающей точкой является знакомство с двоичными числами, имеющими дробные значения. Для начала рассмотрим более знакомую систему десятичного счисления. В последней используется представление в форме:

```
d_m d_{m−1} ... d_1 d_0 . d_{−1} d_{−2} ... d_{−n}
```

где каждая десятичная цифра `d` находится в диапазоне от 0 до 9. Такая запись представляет число `d`, определенное как:

```
d = d_m × 10^m + d_{m−1} × 10^{m−1} + ... + d_0 × 10^0 + d_{−1} × 10^{−1} + d_{−2} × 10^{−2} + ... + d_{−n} × 10^{−n}
```

Веса цифр определяются относительно символа десятичной точки, которая означает, что цифры слева взвешиваются по неотрицательным степеням 10, давая целочисленные значения, а цифры справа — по отрицательным степеням 10, давая дробные значения. Например, число `12.34` в десятичной системе представляет значение:

```
12.34_{10} = 1 × 10^1 + 2 × 10^0 + 3 × 10^{−1} + 4 × 10^{−2}
```

Аналогично, двоичная система использует представление чисел в форме:

```
b_m b_{m−1} ... b_1 b_0 . b_{−1} b_{−2} ... b_{−n}
```

где каждая двоичная цифра (бит) `b_i` находится в диапазоне от 0 до 1

---

При условии, что рассматриваются только кодировки конечной длины, в десятичной системе счисления нельзя точно представить такие числа, как \( \frac{1}{3} \) и \( \frac{1}{5} \).

Подобным же образом, в дробном двоичном обозначении можно представить только числа, которые можно записать как \( x \times 2^y \). Другие величины выражаются лишь приблизительно. Например, число \( \frac{1}{5} \) можно точно представить в десятичной системе счисления как 0.20. Однако в двоичном дробном виде оно не имеет точного представления и может быть только аппроксимировано с нарастающей точностью путем удлинения двоичного представления:

| Представление | Значение      |Десятичное             |
|---------------|---------------|-----------------------|
| 0.0₂          | 0/2           |0.0<sub>10</sub>       |
| 0.01₂         | 1/4           |0.25<sub>10</sub>      |
| 0.010₂        | 2/8           |0.25<sub>10</sub>      |
| 0.0011₂       | 3/16          |0.1875<sub>10</sub>    |
| 0.00110₂      | 6/32          |0.1875<sub>10</sub>    |
| 0.001101₂     | 13/64         |0.203125<sub>10</sub>  |
| 0.0011010₂    | 26/128        |0.203125<sub>10</sub>  |
| 0.00110011₂   | 51/256        |0.19921875<sub>10</sub>|
|---------------|---------------|-----------------------|

## Представление значений с плавающей точкой в стандарте IEEE

Позиционное представление, рассмотренное ранее, неэффективно для очень больших чисел. Например, представление числа `5 × 2^100` будет состоять из комбинации битов `101`, за которой следует 100 нулей. Вместо этого предпочтительнее представлять такие числа в форме `x × 2^y`, задавая значения `x` и `y`.

Стандарт IEEE определяет представление чисел с плавающей точкой в виде:

```bsh
V = (−1)^s × M × 2^E
```

- **s** — символ, определяющий знак числа: отрицательный (s = 1) или положительный (s = 0). Интерпретация знакового разряда для числового значения `0` рассматривается как особый случай.
- **M** — мантисса, представляющая дробное двоичное число в диапазоне от `1` до `2 − ε` или от `0` до `1 − ε`.
- **E** — показатель, который взвешивает величину (возможно, отрицательной) степенью `2`.

Для кодировки этих величин битовое представление числа с плавающей точкой делится на три поля:

- **Знаковый бит s** напрямую кодирует символ `s`.
- **k-разрядное поле показателя exp = e<sub>k−1</sub> ... e<sub>1</sub>e<sub>0</sub>** кодирует показатель `E`.
- **n-разрядное поле дробной части frac = f<sub>n−1</sub> ... f<sub>1</sub>f<sub>0</sub>** кодирует мантиссу `M`. Способ кодирования также зависит от того, равно поле показателя `0` или нет.

На рисунке ниже показано, как эти три поля упакованы в два наиболее распространенных формата:

- **Формат с одинарной точностью** (тип `float` в языке C) имеет размеры полей: `s = 1 бит`, `k = 8 бит`, `n = 23 бита`, что дает 32-разрядное представление.
- **Формат с двойной точностью** (тип `double` в языке C) имеет размеры полей: `s = 1 бит`, `k = 11 бит`, `n = 52 бита`, что дает 64-разрядное представление.


```c
#include <iostream>
#include <iomanip>

int main() {
    unsigned long int i_val = -1;
    std::cout << i_val << std::endl;
    float f_val = i_val;
    std::cout << std::fixed << f_val << std::endl;
    return 0;
}
```